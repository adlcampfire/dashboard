{% extends 'base.html' %}

{% block title %}Voting Results - Admin{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Voting Results</h1>
        <div class="flex gap-2">
            <a href="{{ url_for('admin_results_export') }}" class="btn btn-success">
                <i class="fas fa-download"></i> Export CSV
            </a>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-4">Leaderboard</h2>
        <div class="space-y-4">
            {% for result in results %}
                <div class="flex items-center justify-between p-4 border dark:border-gray-700 rounded-lg {% if loop.index == 1 %}bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300{% elif loop.index == 2 %}bg-gray-100 dark:bg-gray-700 border-gray-300{% elif loop.index == 3 %}bg-orange-50 dark:bg-orange-900/20 border-orange-300{% endif %}">
                    <div class="flex items-center gap-4">
                        <div class="text-2xl font-bold text-gray-600 dark:text-gray-400 w-12 text-center">
                            {% if loop.index == 1 %}ðŸ¥‡{% elif loop.index == 2 %}ðŸ¥ˆ{% elif loop.index == 3 %}ðŸ¥‰{% else %}{{ loop.index }}{% endif %}
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold">{{ result.team.name }}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">{{ result.vote_count }} vote{{ 's' if result.vote_count != 1 else '' }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">
                            {{ "%.2f"|format(result.average_score) }}
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">out of 100</div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Detailed Scores -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-semibold mb-4">Detailed Scores</h2>
        {% for result in results %}
            <div class="mb-8 border-b dark:border-gray-700 pb-8 last:border-b-0">
                <h3 class="text-xl font-semibold mb-4">{{ result.team.name }}</h3>
                
                {% if result.votes %}
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Judge</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Innovation<br><span class="text-xs font-normal">(30%)</span></th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Implementation<br><span class="text-xs font-normal">(30%)</span></th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Design<br><span class="text-xs font-normal">(20%)</span></th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Presentation<br><span class="text-xs font-normal">(20%)</span></th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Comments</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                {% for vote in result.votes %}
                                    <tr>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">@{{ vote.judge.username }}</td>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ vote.innovation_score }}/10</td>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ vote.implementation_score }}/10</td>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ vote.design_score }}/10</td>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{{ vote.presentation_score }}/10</td>
                                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold text-blue-600 dark:text-blue-400">{{ "%.2f"|format(vote.calculate_total_score()) }}</td>
                                        <td class="px-4 py-4 text-sm text-gray-500 dark:text-gray-400">{{ vote.comments or '-' }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-gray-600 dark:text-gray-400 italic">No votes submitted yet.</p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}
